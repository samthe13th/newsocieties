
<ng-container *ngIf="($division | async) as division">
<!-- 
  <div class="player-turn">
    <app-player-turn 
      [divisionPath]="divisionPath">
    </app-player-turn>
  </div> -->

  <ng-container *ngIf="signedIn else signInTemplate">
    <app-flash-news [showKey]="showKey" [divisionKey]="divisionKey"></app-flash-news>

    <div class="player-page-layout">
  
      <!-- ON-BOARDING -->
      <ng-container *ngIf="focus === 'none'">
        <div class="onboarding-page">
          <h1>Welcome to the {{division?.code}} Division!</h1>
        </div>
      </ng-container>
  
      <!-- HARVEST -->
      <ng-container *ngIf="focus === 'harvest'">
        <div class="flex-row" style="width: 100%">
          <div class="player-folder__body-harvest">
            <app-land-grid 
              #landGrid
              [markCards]="false"
              [turn]="division?.turn"
              [updatePath]="landTilesPath"
              [showId]="showKey"
              [player]="$player | async"
              [divisionKey]="divisionKey"
              (gatherResource)="onGather($event)"
              (select)="onSelect($event)"
            ></app-land-grid>
          </div>
        </div>
      </ng-container>
      
      <!-- VOTE -->
      <ng-container *ngIf="focus === 'resolutions' || focus === 'principles' || focus === 'scenerio'">
        <div class="player-vote-wrap">
          <div class="relative-position">
            <div class="tab-background voting blur" >
              <img src="assets/hex.jpg"/>
            </div>
      
            <div class="tab-foreground player-vote">
              <div *ngIf="hasVoted && vote?.state === 'voting'" style="text-align: center">
                <p>Thanks for voting!</p>
                <p>Waiting for polls to close...</p>
              </div>
              <ng-container *ngIf="!(hasVoted && vote?.state === 'voting')">
                <app-vote
                  (selectionChange)="onSelectionChange($event)"
                  [showVotes]="vote?.state === 'review'"
                  [allowSelection]="vote?.state === 'voting'"
                  [showId]="showKey"
                  role="citizen"
                  hideOption="last"
                  [divisionId]="division.code"
                ></app-vote>
                <button class="action-button" *ngIf="!hasVoted && vote?.state === 'voting'" (click)="castVote()">Vote</button>
              </ng-container>
            </div>
          </div>
          <!-- <div>
            <app-fundraising
              *ngIf="vote?.state === 'review'"
              [showKey]="showKey"
              [divisionKey]="divisionKey"
              [playerId]="id">
            </app-fundraising>
          </div> -->
        </div>
      </ng-container>

      <ng-container  *ngIf="focus === 'misc'">
        <app-society-grid [showKey]="showKey" details="brief"></app-society-grid>
      </ng-container>
  
      <!-- PLAYER CONTROLS -->
      <div class="player-folder__body-citizens space-between">
        <div class="harvest-details">
          <div class="flex-column stretch-h">
            <div class="large">Reserve:
              <span class="harvest-details__number">{{division?.reserve}}</span>
            </div>
            <div class="flex-column stretch-h">
              <div>Thresholds</div>
              <div>
                <span class="harvest-details__number">
                  {{division?.reserveThresholds.low}}
                  | {{division?.reserveThresholds.mid}}
                  | {{division?.reserveThresholds.high}}
                </span>
              </div>
            </div>
          </div>
          <div class="flex-column stretch-h">
            <div class="large">Harvested: <span class="harvest-details__number">{{division?.harvested}}</span></div>
            <div class="flex-column stretch-h">
              <div>Capacity</div>
              <div>
                <span class="harvest-details__number">
                  {{division?.capacity}}
                </span>
              </div>
            </div>
          </div>
        </div>
  
        <app-player-deck
          [id]="id" 
          [myTurn]="id == ($turn | async)?.id"
          [showKey]="showKey"
          [division]="division">
        </app-player-deck>
  
        <div class="citizen-list">
          <div 
            class="citizen-summary flex-row space-between"
            *ngFor="let citizen of ($citizens | async)">
            <div class="flex-row flex-center-v">
              <span [class.player-turn-indicator]="citizen.id == ($turn | async)?.id">{{citizen.name}}</span>
              <span>({{calculateWealth(citizen?.resources)}})</span>
              <!-- <app-player-turn 
                [showLabel]="false"
                [divisionPath]="divisionPath">
              </app-player-turn> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </ng-container>

  <!-- <app-tabs
    selectedClass="player-selected-tab"
    [tabs]="[
      { id: 'division', tabTemplate: divisionTab, bodyTemplate: divisionBody },
      { id: 'global', tabTemplate: global, bodyTemplate: globalBody }
    ]"
  ></app-tabs> -->

  <ng-template #divisionTab>
    <div class="player-folder__tab-division">
      {{ division?.code }}
    </div>
    <h1>Season {{ division?.season }}: {{division?.focus}}</h1>
  </ng-template>

  <ng-template #global>Global</ng-template>

  <ng-template #globalBody>
    <app-society-grid></app-society-grid>
  </ng-template>

  <ng-template #tileSelectSheet>
    <div class="action-sheet">
      {{ selectedResourceStatus?.message }}
      <div 
        *ngIf="selectedResourceStatus?.status === 'explorable'" 
        class="large-action-button"
        (click)="explore()">
        <fa-icon size="lg" [icon]="exploreIcon"></fa-icon>
        Explore (e)
      </div>
      <div 
        *ngIf="selectedResourceStatus?.status === 'explored' || selectedResourceStatus?.status === 'explorable'"
        class="large-action-button"
        (click)="gather()">
        <fa-icon size="lg" [icon]="gatherIcon"></fa-icon>
        Gather (g)
      </div>
    </div>
  </ng-template>

  <ng-template #signInTemplate>

    <div class="user-signin">
      <h1>{{ division?.code }} Division</h1>
      <br/>

      <div *ngIf="!id" class="user-signin-form">
        Enter your show code!
        <input #userCode type="text">
        <br/>

        <button (click)="signIn(userCode.value)" class="action-button">
          Sign In
        </button>
      </div>

      <div *ngIf="id" class="user-signin-form">
        Enter a name for us to call you by!
        <input #userName type="text">
        <br/>
  
        <button class="action-button" (click)="setName(userName.value)">
          Join Division
        </button>
      </div>

      <br/>

      <div *ngFor="let validation of loginValidations">
        <em>{{ validation }}</em>
      </div>

    </div>

  </ng-template>

</ng-container>