<ng-container *ngIf="($division | async) as division">
  <app-tabs
    selectedClass="player-selected-tab"
    [tabs]="[
      { id: 'division', tabTemplate: divisionTab, bodyTemplate: divisionBody },
      { id: 'global', tabTemplate: global, bodyTemplate: globalBody }
    ]"
  ></app-tabs>

  <ng-template #divisionTab>
    <div class="player-folder__tab-division">
      {{ division?.code }}
    </div>
    Season {{ division?.season }}
  </ng-template>

  <ng-template #global>Global</ng-template>

  <ng-template #divisionBody>
    <ng-container *ngIf="focus === 'harvest'">
      <div class="player-hints">
        It's your turn! Click on a harvest resource to explore or gather.
      </div>
      <div class="flex-row">
        <div class="player-folder__body-harvest">
          <div class="player-folder__body-title">
            <h1>Harvest</h1>
            <div class="harvest-details">
              <div>Capacity: {{division?.capacity}}+{{division?.extra}}</div>
              <div>Harvested: {{division?.harvested}}</div>
            </div>
          </div>
          <app-land-grid 
            #landGrid
            [markCards]="false"
            [updatePath]="landTilesPath"
            [showId]="showKey"
            [playerId]="id"
            (gatherResource)="onGather($event)"
            (select)="onSelect($event)"
          ></app-land-grid>
        </div>
        <div class="player-folder__body-citizens space-between">
          <app-player-deck 
            [id]="id" 
            [division]="division">
          </app-player-deck>

          <div class="citizen-list">
            <div 
              class="citizen-summary flex-row space-between"
              *ngFor="let citizen of filterOutCitizen(division.citizens, id)">
              <div class="flex-row flex-center-v">
                <span class="citizen-id">{{citizen.id}}</span>
                <span>{{citizen.name}}</span>
              </div>
              <div *ngIf="citizen">
                {{ addResources(citizen.resources) }}
              </div>
            </div>
          </div>
    
        <button (click)="buy({ cost: 2 })">Spend $2</button>
          <button (click)="buy({ cost: 5 })">Spend $5</button>
          <button (click)="buy({ cost: 6 })">Spend $6</button>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="focus === 'vote'">
      <h1>Resolution</h1>
      <div *ngIf="hasVoted && vote?.state === 'voting'">Thanks for voting! Waiting for polls to close...</div>
      <ng-container *ngIf="!(hasVoted && vote?.state === 'voting')">
        <app-vote
          (selectionChange)="onSelectionChange($event)"
          [showVotes]="vote?.state === 'review'"
          [allowSelection]="vote?.state === 'voting'"
          [showId]="showKey"
          hideOption="last"
          [divisionId]="division.code"
        ></app-vote>
        <button *ngIf="!hasVoted && vote?.state === 'voting'" (click)="castVote()">Vote</button>
        <app-fundraising
          *ngIf="vote?.state === 'review'"
          [showKey]="showKey"
          [divisionKey]="divisionKey"
          [playerId]="id">
        </app-fundraising>
      </ng-container>
    </ng-container>
  </ng-template>

  <ng-template #globalBody>
    <app-society-grid></app-society-grid>
  </ng-template>

  <ng-template #tileSelectSheet>
    <div class="action-sheet">
      {{ selectedResourceStatus?.message }}
      <div 
        *ngIf="selectedResourceStatus?.status === 'explorable'" 
        class="large-action-button"
        (click)="explore()">
        <fa-icon size="lg" [icon]="exploreIcon"></fa-icon>
        Explore (e)
      </div>
      <div 
        *ngIf="selectedResourceStatus?.status === 'explored' || selectedResourceStatus?.status === 'explorable'"
        class="large-action-button"
        (click)="gather()">
        <fa-icon size="lg" [icon]="gatherIcon"></fa-icon>
        Gather (g)
      </div>
    </div>
  </ng-template>

</ng-container>